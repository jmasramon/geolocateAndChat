<!DOCTYPE html>
<head>
    <title>
        Backbone chat
    </title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true">
    </script>
    <script type="text/javascript" src="js/geometa.js">
    </script>
    <script type="text/javascript">
        var positionChanged = false;
        function initialise() {
            prepareGeolocation();
            doGeolocation();
            //positionSuccess({coords:{latitude: 35, longitude: 39}}); // Per probar que ho estic posant bé
        }

        function doGeolocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(positionSuccess, positionError);
            } else {
                positionError(-1);
            }
        }

        function positionError(err) {
            var msg;
            switch (err.code) {
            case err.UNKNOWN_ERROR:
                msg = "Unable to find your location";
                break;
            case err.PERMISSION_DENINED:
                msg = "Permission denied in finding your location";
                break;
            case err.POSITION_UNAVAILABLE:
                msg = "Your location is currently unknown";
                break;
            case err.BREAK:
                msg = "Attempt to find location took too long";
                break;
            default:
                msg = "Location detection not supported in browser";
            }
            console.info(msg);
            // document.getElementById('info').innerHTML = msg;
        }

        function positionSuccess(position) {
            // Get coordinates
            var coords = position.coords || position.coordinate || position;
            var latLng = new google.maps.LatLng(coords.latitude, coords.longitude);

            // Store them in the form hidden input 
            if (coords.latitude != document.getElementById('lat').value){
                positionChanged = true;
                document.getElementById('lat').value = coords.latitude;
            }
            // document.getElementById('lat').style.visibility='visible';
            // console.info(document.getElementById('lat').value);
            if (coords.longitude != document.getElementById('lng').value){
                positionChanged = true;
                document.getElementById('lng').value = coords.longitude;
            }
            // document.getElementById('lng').style.visibility='visible';
            // console.info(document.getElementById('lng').value);
        }

        // function controlarMovimiento(){
         //     setInterval( function () {
         //         // window.console && console.log('Miramos posición actual');
         //         doGeolocation();
         //         ChatApp.Connection.positionChange(document.getElementById('nickName').value, document.getElementById('lat').value, document.getElementById('lng').value);
         //     }, 1000);
         // }
    </script>
    <link href="css/bootstrap-responsive.css" type="text/css" rel="stylesheet"
    />
    <script type="text/javascript" src="js/vendor/jquery.min.js">
    </script>
    <script type="text/javascript" src="js/vendor/underscore.js">
    </script>
    <script type="text/javascript" src="js/vendor/backbone.js">
    </script>
    <script type="text/javascript" src="js/vendor/socket.io.js">
    </script>
    <script type="text/javascript" src="js/vendor/less.min.js">
    </script>
    <script type="text/javascript" src="js/chatapp.js">
    </script>
    <script type="text/javascript" src="js/models.js">
    </script>
    <script type="text/javascript" src="js/connection.js">
    </script>
    <script type="text/javascript" src="js/view.inputarea.js">
    </script>
    <script type="text/javascript" src="js/view.messagelist.js">
    </script>
    <script type="text/javascript" src="js/view.userlist.js">
    </script>
    <script type="text/javascript" src="js/view.welcome.js">
    </script>
    <script type="text/javascript" src="js/view.esperando.js">
    </script>
    <script type="text/javascript" src="js/application.js">
    </script>
<!-- per producció
    <link rel="stylesheet" type="text/css" href="css/jasmine.css">
    <script type="text/javascript" src="js/vendor/jasmine.js">
    </script>
    <script type="text/javascript" src="js/vendor/jasmine-html.js">
    </script>
    <script type="text/javascript" src="js/vendor/jasmine-jquery.js">
    </script>
    <!-- include source files here... -->
    <!--script type="text/javascript" src="src/Player.js"></script-->
    <!--script type="text/javascript" src="src/Song.js"></script-->
    <!-- include spec files here... -->
    <!--script type="text/javascript" src="spec/SpecHelper.js"></script-->
    <!--script type="text/javascript" src="spec/PlayerSpec.js"></script-->
<!-- per producció
    <script type="text/javascript">
        (function() {
        var jasmineEnv = jasmine.getEnv();
        jasmineEnv.updateInterval = 1000;

        var htmlReporter = new jasmine.HtmlReporter();

        jasmineEnv.addReporter(htmlReporter);

        jasmineEnv.specFilter = function(spec) {
            return htmlReporter.specFilter(spec);
        };

        var currentWindowOnload = window.onload;

        window.onload = function() {
            if (currentWindowOnload) {
                currentWindowOnload();
            }
            execJasmine();
        };

        function execJasmine() {
            window.console && console.log('Executant execJasmine');
            jasmineEnv.execute();
        }

    })();
    </script>
per producció --> 
</head>
<!-- <body onload="initialise()"> -->
<body>
    <section class="welcome">
        <h1>
            Welcome!
        </h1>
        <p>
            Please enter your nickname and email address to get started
        </p>
        <form class="form-horizontal">
            <div class="control-group">
                <label class="control-label" for="nickName">
                    Nickname
                </label>
                <div class="controls">
                    <input name="nickName" id="nickName" class="input-medium" required/>
                </div>
            </div>
            <div class="control-group">
                <label class="control-label" for="email">
                    Email address
                </label>
                <div class="controls">
                    <input name="email" id="email" type="email" required/>
                </div>
                <button type="submit" class="btn">
                    Connect
                </button>
            </div>
            <input name="lat" type="lat" id="lat" class="template" value="41.395039"
            />
            <input name="lng" type="lng" id="lng" class="template" value="2.148918"
            />
        </form>
    </section>
    <section class="esperando template">
        <h1>
            Buscando a otro usuario cerca!
        </h1>
        <p>
            Por favor, espera a ser notificado
        </p>
    </section>
    <div class="container">
        <section class="messages template">
            <ul class="no-padding">
                <li class="template triangle-border">
                    <div class="nickName">
                        Mustachio
                    </div>
                    <time>
                        12:04am
                    </time>
                    <p>
                        Hello world!
                    </p>
                </li>
            </ul>
        </section>
        <section class="userList template">
            <ul class="no-padding">
                <li class="template">
                    Mustaschio
                </li>
            </ul>
        </section>
    </div>
    <section class="inputArea template">
        <form>
            <i class="icon-edit"></i>
            <input type="text" name="message" autocomplete="off" />
            <button type="submit">Submit</button>
        </form>
    </section>
    <!-- per producció
    <script type="text/javascript" src="test/environtmentTest.jasmine.js">
    </script>
    <script type="text/javascript" src="test/welcomeViewTest.jasmine.js">
    </script>
    <script type="text/javascript" src="test/esperandoViewTest.jasmine.js">
    </script>
    <script type="text/javascript" src="test/userlistViewTest.jasmine.js">
    </script>
    <script type="text/javascript" src="test/inputareaViewTest.jasmine.js">
    </script>
    <script type="text/javascript" src="test/messagelistViewTest.jasmine.js">
    </script>
    per producció -->
</body>